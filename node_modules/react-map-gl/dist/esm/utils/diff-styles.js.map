{"version":3,"sources":["../../../src/utils/diff-styles.js"],"names":["diffSources","prevStyle","nextStyle","prevSources","get","nextSources","enter","update","exit","prevIds","keySeq","toArray","nextIds","id","nextSource","equals","push","source","prevSource","diffLayers","prevLayers","nextLayers","updates","exiting","prevMap","nextMap","forEach","layer","index","layerImBehind","before","reverse","diffStyle","sourcesDiff","layersDiff"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* eslint-disable max-statements */\nexport function diffSources(prevStyle, nextStyle) {\n  const prevSources = prevStyle.get('sources');\n  const nextSources = nextStyle.get('sources');\n  const enter = [];\n  const update = [];\n  const exit = [];\n  const prevIds = prevSources.keySeq().toArray();\n  const nextIds = nextSources.keySeq().toArray();\n  for (const id of prevIds) {\n    const nextSource = nextSources.get(id);\n    if (nextSource) {\n      if (!nextSource.equals(prevSources.get(id))) {\n        update.push({id, source: nextSources.get(id)});\n      }\n    } else {\n      exit.push({id, source: prevSources.get(id)});\n    }\n  }\n  for (const id of nextIds) {\n    const prevSource = prevSources.get(id);\n    if (!prevSource) {\n      enter.push({id, source: nextSources.get(id)});\n    }\n  }\n  return {enter, update, exit};\n}\n/* eslint-enable max-statements */\n\nexport function diffLayers(prevStyle, nextStyle) {\n  const prevLayers = prevStyle.get('layers');\n  const nextLayers = nextStyle.get('layers');\n  const updates = [];\n  const exiting = [];\n  const prevMap = {};\n  const nextMap = {};\n  nextLayers.forEach((layer, index) => {\n    const id = layer.get('id');\n    const layerImBehind = nextLayers.get(index + 1);\n    nextMap[id] = {\n      layer,\n      id,\n      // The `id` of the layer before this one.\n      before: layerImBehind ? layerImBehind.get('id') : null,\n      enter: true\n    };\n  });\n  prevLayers.forEach((layer, index) => {\n    const id = layer.get('id');\n    const layerImBehind = prevLayers.get(index + 1);\n    prevMap[id] = {\n      layer,\n      id,\n      before: layerImBehind ? layerImBehind.get('id') : null\n    };\n    if (nextMap[id]) {\n      // Not a new layer.\n      nextMap[id].enter = false;\n    } else {\n      // This layer is being removed.\n      exiting.push(prevMap[id]);\n    }\n  });\n  for (const layer of nextLayers.reverse()) {\n    const id = layer.get('id');\n    if (\n      !prevMap[id] ||\n      !prevMap[id].layer.equals(nextMap[id].layer) ||\n      prevMap[id].before !== nextMap[id].before\n    ) {\n      // This layer is being changed.\n      updates.push(nextMap[id]);\n    }\n  }\n  return {updates, exiting};\n}\n\nexport default function diffStyle(prevStyle, nextStyle) {\n  return {\n    sourcesDiff: diffSources(prevStyle, nextStyle),\n    layersDiff: diffLayers(prevStyle, nextStyle)\n  };\n}\n"],"file":"diff-styles.js"}