{"version":3,"sources":["../../../src/components/interactive-map.js"],"names":["PureComponent","createElement","PropTypes","StaticMap","MAPBOX_LIMITS","WebMercatorViewport","TransitionManager","getInteractiveLayerIds","EventManager","MapControls","config","deprecateWarn","propTypes","Object","assign","maxZoom","number","minZoom","maxPitch","minPitch","onViewStateChange","func","onViewportChange","transitionDuration","transitionInterpolator","object","transitionInterruption","transitionEasing","onTransitionStart","onTransitionInterrupt","onTransitionEnd","scrollZoom","bool","dragPan","dragRotate","doubleClickZoom","touchZoom","touchRotate","keyboard","onHover","onClick","onContextMenu","touchAction","string","clickRadius","getCursor","mapControls","shape","events","arrayOf","handleEvent","getDefaultCursor","isDragging","isHovering","CURSOR","GRABBING","POINTER","GRAB","defaultProps","event","preventDefault","childContextTypes","viewport","instanceOf","eventManager","InteractiveMap","props","state","_mapControls","_eventManager","legacyBlockScroll","_updateQueryParams","mapStyle","getMap","bind","queryRenderedFeatures","_getFeatures","_onInteractiveStateChange","_getPos","_eventCanvasLoaded","_staticMapLoaded","supported","on","mousemove","_onMouseMove","click","_onMouseClick","contextmenu","_onContextMenu","setOptions","viewState","onStateChange","_transitionManager","nextProps","nextPropsWithViewState","processViewportChange","_map","geometry","options","features","pos","radius","size","bbox","_queryParams","interactiveLayerIds","layers","setState","offsetCenter","x","y","length","lngLat","unproject","ref","setElement","width","height","eventCanvasStyle","position","cursor","key","style","getViewportInTransition","children","displayName"],"mappings":"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","sourcesContent":["import {PureComponent, createElement} from 'react';\nimport PropTypes from 'prop-types';\n\nimport StaticMap from './static-map';\nimport {MAPBOX_LIMITS} from '../utils/map-state';\nimport WebMercatorViewport from 'viewport-mercator-project';\n\nimport TransitionManager from '../utils/transition-manager';\nimport {getInteractiveLayerIds} from '../utils/style-utils';\n\nimport {EventManager} from 'mjolnir.js';\nimport MapControls from '../utils/map-controls';\nimport config from '../config';\nimport deprecateWarn from '../utils/deprecate-warn';\n\nconst propTypes = Object.assign({}, StaticMap.propTypes, {\n  // Additional props on top of StaticMap\n\n  /** Viewport constraints */\n  // Max zoom level\n  maxZoom: PropTypes.number,\n  // Min zoom level\n  minZoom: PropTypes.number,\n  // Max pitch in degrees\n  maxPitch: PropTypes.number,\n  // Min pitch in degrees\n  minPitch: PropTypes.number,\n\n  // Callbacks fired when the user interacted with the map. The object passed to the callbacks\n  // contains viewport properties such as `longitude`, `latitude`, `zoom` etc.\n  onViewStateChange: PropTypes.func,\n  onViewportChange: PropTypes.func,\n\n  /** Viewport transition **/\n  // transition duration for viewport change\n  transitionDuration: PropTypes.number,\n  // TransitionInterpolator instance, can be used to perform custom transitions.\n  transitionInterpolator: PropTypes.object,\n  // type of interruption of current transition on update.\n  transitionInterruption: PropTypes.number,\n  // easing function\n  transitionEasing: PropTypes.func,\n  // transition status update functions\n  onTransitionStart: PropTypes.func,\n  onTransitionInterrupt: PropTypes.func,\n  onTransitionEnd: PropTypes.func,\n\n  /** Enables control event handling */\n  // Scroll to zoom\n  scrollZoom: PropTypes.bool,\n  // Drag to pan\n  dragPan: PropTypes.bool,\n  // Drag to rotate\n  dragRotate: PropTypes.bool,\n  // Double click to zoom\n  doubleClickZoom: PropTypes.bool,\n  // Multitouch zoom\n  touchZoom: PropTypes.bool,\n  // Multitouch rotate\n  touchRotate: PropTypes.bool,\n  // Keyboard\n  keyboard: PropTypes.bool,\n\n /**\n    * Called when the map is hovered over.\n    * @callback\n    * @param {Object} event - The mouse event.\n    * @param {[Number, Number]} event.lngLat - The coordinates of the pointer\n    * @param {Array} event.features - The features under the pointer, using Mapbox's\n    * queryRenderedFeatures API:\n    * https://www.mapbox.com/mapbox-gl-js/api/#Map#queryRenderedFeatures\n    * To make a layer interactive, set the `interactive` property in the\n    * layer style to `true`. See Mapbox's style spec\n    * https://www.mapbox.com/mapbox-gl-style-spec/#layer-interactive\n    */\n  onHover: PropTypes.func,\n  /**\n    * Called when the map is clicked.\n    * @callback\n    * @param {Object} event - The mouse event.\n    * @param {[Number, Number]} event.lngLat - The coordinates of the pointer\n    * @param {Array} event.features - The features under the pointer, using Mapbox's\n    * queryRenderedFeatures API:\n    * https://www.mapbox.com/mapbox-gl-js/api/#Map#queryRenderedFeatures\n    * To make a layer interactive, set the `interactive` property in the\n    * layer style to `true`. See Mapbox's style spec\n    * https://www.mapbox.com/mapbox-gl-style-spec/#layer-interactive\n    */\n  onClick: PropTypes.func,\n  /**\n    * Called when the context menu is activated.\n    */\n  onContextMenu: PropTypes.func,\n\n  /** Custom touch-action CSS for the event canvas. Defaults to 'none' */\n  touchAction: PropTypes.string,\n\n  /** Radius to detect features around a clicked point. Defaults to 0. */\n  clickRadius: PropTypes.number,\n\n  /** Accessor that returns a cursor style to show interactive state */\n  getCursor: PropTypes.func,\n\n  // A map control instance to replace the default map controls\n  // The object must expose one property: `events` as an array of subscribed\n  // event names; and two methods: `setState(state)` and `handle(event)`\n  mapControls: PropTypes.shape({\n    events: PropTypes.arrayOf(PropTypes.string),\n    handleEvent: PropTypes.func\n  })\n});\n\nconst getDefaultCursor = ({isDragging, isHovering}) => isDragging ?\n  config.CURSOR.GRABBING :\n  (isHovering ? config.CURSOR.POINTER : config.CURSOR.GRAB);\n\nconst defaultProps = Object.assign({},\n  StaticMap.defaultProps, MAPBOX_LIMITS, TransitionManager.defaultProps,\n  {\n    onViewStateChange: null,\n    onViewportChange: null,\n    onClick: null,\n    onHover: null,\n    onContextMenu: event => event.preventDefault(),\n\n    scrollZoom: true,\n    dragPan: true,\n    dragRotate: true,\n    doubleClickZoom: true,\n\n    touchAction: 'none',\n    clickRadius: 0,\n    getCursor: getDefaultCursor\n  }\n);\n\nconst childContextTypes = {\n  viewport: PropTypes.instanceOf(WebMercatorViewport),\n  isDragging: PropTypes.bool,\n  eventManager: PropTypes.object\n};\n\nexport default class InteractiveMap extends PureComponent {\n\n  static supported() {\n    return StaticMap.supported();\n  }\n\n  constructor(props) {\n    super(props);\n    // Check for deprecated props\n    deprecateWarn(props);\n\n    this.state = {\n      // Whether the cursor is down\n      isDragging: false,\n      // Whether the cursor is over a clickable feature\n      isHovering: false\n    };\n\n    // If props.mapControls is not provided, fallback to default MapControls instance\n    // Cannot use defaultProps here because it needs to be per map instance\n    this._mapControls = props.mapControls || new MapControls();\n\n    this._eventManager = new EventManager(null, {\n      legacyBlockScroll: false,\n      touchAction: props.touchAction\n    });\n\n    this._updateQueryParams(props.mapStyle);\n\n    this.getMap = this.getMap.bind(this);\n    this.queryRenderedFeatures = this.queryRenderedFeatures.bind(this);\n    this._getFeatures = this._getFeatures.bind(this);\n    this._updateQueryParams = this._updateQueryParams.bind(this);\n    this._onInteractiveStateChange = this._onInteractiveStateChange.bind(this);\n    this._getPos = this._getPos.bind(this);\n    this._eventCanvasLoaded = this._eventCanvasLoaded.bind(this);\n    this._staticMapLoaded = this._staticMapLoaded.bind(this);\n  }\n\n  getChildContext() {\n    return {\n      viewport: new WebMercatorViewport(this.props),\n      isDragging: this.state.isDragging,\n      eventManager: this._eventManager\n    };\n  }\n\n  componentDidMount() {\n    const eventManager = this._eventManager;\n\n    // Register additional event handlers for click and hover\n    eventManager.on({\n      mousemove: this._onMouseMove.bind(this),\n      click: this._onMouseClick.bind(this),\n      contextmenu: this._onContextMenu.bind(this)\n    });\n\n    this._mapControls.setOptions(Object.assign({}, this.props, this.props.viewState, {\n      onStateChange: this._onInteractiveStateChange,\n      eventManager\n    }));\n\n    this._transitionManager = new TransitionManager(this.props);\n  }\n\n  componentWillUpdate(nextProps) {\n    if (this.props.mapStyle !== nextProps.mapStyle) {\n      this._updateQueryParams(nextProps.mapStyle);\n    }\n\n    const nextPropsWithViewState = Object.assign({}, nextProps, nextProps.viewState);\n    this._mapControls.setOptions(nextPropsWithViewState);\n    this._transitionManager.processViewportChange(nextPropsWithViewState);\n  }\n\n  getMap() {\n    return this._map ? this._map.getMap() : null;\n  }\n\n  queryRenderedFeatures(geometry, options) {\n    return this._map.queryRenderedFeatures(geometry, options);\n  }\n\n  _getFeatures({pos, radius}) {\n    let features;\n    if (radius) {\n      // Radius enables point features, like marker symbols, to be clicked.\n      const size = radius;\n      const bbox = [[pos[0] - size, pos[1] + size], [pos[0] + size, pos[1] - size]];\n      features = this._map.queryRenderedFeatures(bbox, this._queryParams);\n    } else {\n      features = this._map.queryRenderedFeatures(pos, this._queryParams);\n    }\n    return features;\n  }\n\n  // Hover and click only query layers whose interactive property is true\n  _updateQueryParams(mapStyle) {\n    const interactiveLayerIds = getInteractiveLayerIds(mapStyle);\n    this._queryParams = {layers: interactiveLayerIds};\n  }\n\n  _onInteractiveStateChange({isDragging = false}) {\n    if (isDragging !== this.state.isDragging) {\n      this.setState({isDragging});\n    }\n  }\n\n  // HOVER AND CLICK\n  _getPos(event) {\n    const {offsetCenter: {x, y}} = event;\n    return [x, y];\n  }\n\n  _onMouseMove(event) {\n    if (!this.state.isDragging) {\n      const pos = this._getPos(event);\n      const features = this._getFeatures({pos, radius: this.props.clickRadius});\n\n      const isHovering = features && features.length > 0;\n      if (isHovering !== this.state.isHovering) {\n        this.setState({isHovering});\n      }\n\n      if (this.props.onHover) {\n        const viewport = new WebMercatorViewport(this.props);\n        event.lngLat = viewport.unproject(pos);\n        event.features = features;\n\n        this.props.onHover(event);\n      }\n    }\n  }\n\n  _onMouseClick(event) {\n    if (this.props.onClick) {\n      const pos = this._getPos(event);\n      const viewport = new WebMercatorViewport(this.props);\n      event.lngLat = viewport.unproject(pos);\n      event.features = this._getFeatures({pos, radius: this.props.clickRadius});\n\n      this.props.onClick(event);\n    }\n  }\n\n  _onContextMenu(event) {\n    if (this.props.onContextMenu) {\n      this.props.onContextMenu(event);\n    }\n  }\n\n  _eventCanvasLoaded(ref) {\n    // This will be called with `null` after unmount, releasing event manager resource\n    this._eventManager.setElement(ref);\n  }\n\n  _staticMapLoaded(ref) {\n    this._map = ref;\n  }\n\n  render() {\n    const {width, height, getCursor} = this.props;\n\n    const eventCanvasStyle = {\n      width,\n      height,\n      position: 'relative',\n      cursor: getCursor(this.state)\n    };\n\n    return (\n      createElement('div', {\n        key: 'map-controls',\n        ref: this._eventCanvasLoaded,\n        style: eventCanvasStyle\n      },\n        createElement(StaticMap, Object.assign({}, this.props,\n          this._transitionManager && this._transitionManager.getViewportInTransition(),\n          {\n            ref: this._staticMapLoaded,\n            children: this.props.children\n          }\n        ))\n      )\n    );\n  }\n}\n\nInteractiveMap.displayName = 'InteractiveMap';\nInteractiveMap.propTypes = propTypes;\nInteractiveMap.defaultProps = defaultProps;\nInteractiveMap.childContextTypes = childContextTypes;\n"],"file":"interactive-map.js"}