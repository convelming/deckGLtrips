{"version":3,"sources":["../../../src/components/popup.js"],"names":["createElement","PropTypes","BaseControl","getDynamicPosition","ANCHOR_POSITION","propTypes","Object","assign","className","string","longitude","number","isRequired","latitude","offsetLeft","offsetTop","tipSize","closeButton","bool","closeOnClick","anchor","oneOf","keys","dynamicPosition","onClose","func","defaultProps","Popup","constructor","props","_getPosition","bind","_onClose","_contentLoaded","_renderTip","_renderContent","_closeOnClick","componentDidMount","forceUpdate","x","y","viewport","context","_content","padding","width","height","selfWidth","clientWidth","selfHeight","clientHeight","_onClick","evt","captureClick","stopPropagation","ref","key","style","borderWidth","children","type","onClick","render","project","positionType","anchorPosition","containerStyle","position","left","top","transform","_onContainerLoad","displayName"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {createElement} from 'react';\nimport PropTypes from 'prop-types';\nimport BaseControl from './base-control';\n\nimport {getDynamicPosition, ANCHOR_POSITION} from '../utils/dynamic-position';\n\nconst propTypes = Object.assign({}, BaseControl.propTypes, {\n  // Custom className\n  className: PropTypes.string,\n  // Longitude of the anchor point\n  longitude: PropTypes.number.isRequired,\n  // Latitude of the anchor point\n  latitude: PropTypes.number.isRequired,\n  // Offset from the left\n  offsetLeft: PropTypes.number,\n  // Offset from the top\n  offsetTop: PropTypes.number,\n  // Size of the tip\n  tipSize: PropTypes.number,\n  // Whether to show close button\n  closeButton: PropTypes.bool,\n  // Whether to close on click\n  closeOnClick: PropTypes.bool,\n  // The popup's location relative to the coordinate\n  anchor: PropTypes.oneOf(Object.keys(ANCHOR_POSITION)),\n  // Whether the popup anchor should be auto-adjusted to fit within the container\n  dynamicPosition: PropTypes.bool,\n  // Callback when component is closed\n  onClose: PropTypes.func\n});\n\nconst defaultProps = Object.assign({}, BaseControl.defaultProps, {\n  className: '',\n  offsetLeft: 0,\n  offsetTop: 0,\n  tipSize: 10,\n  anchor: 'bottom',\n  dynamicPosition: true,\n  closeButton: true,\n  closeOnClick: true,\n  onClose: () => {}\n});\n\n/*\n * PureComponent doesn't update when context changes.\n * The only way is to implement our own shouldComponentUpdate here. Considering\n * the parent component (StaticMap or InteractiveMap) is pure, and map re-render\n * is almost always triggered by a viewport change, we almost definitely need to\n * recalculate the popup's position when the parent re-renders.\n */\nexport default class Popup extends BaseControl {\n\n  constructor(props) {\n    super(props);\n\n    this._getPosition = this._getPosition.bind(this);\n    this._onClose = this._onClose.bind(this);\n    this._contentLoaded = this._contentLoaded.bind(this);\n    this._renderTip = this._renderTip.bind(this);\n    this._renderContent = this._renderContent.bind(this);\n\n    this._closeOnClick = false;\n  }\n\n  componentDidMount() {\n    // Container just got a size, re-calculate position\n    this.forceUpdate();\n  }\n\n  _getPosition(x, y) {\n    const {viewport} = this.context;\n    const {anchor, dynamicPosition, tipSize} = this.props;\n\n    if (this._content) {\n      return dynamicPosition ? getDynamicPosition({\n        x, y, anchor,\n        padding: tipSize,\n        width: viewport.width,\n        height: viewport.height,\n        selfWidth: this._content.clientWidth,\n        selfHeight: this._content.clientHeight\n      }) : anchor;\n    }\n\n    return anchor;\n  }\n\n  /*\n   * Hack -\n   * React's `onClick` is called before mjolnir.js' `click` event (aka `tap` from hammer.js)\n   * which has a configurable delay.\n   * If we close the popup on the React event, by the time `click` fires, this component will\n   * have been unmounted, thus `captureClick` will not work.\n   * Instead, we flag the popup as closed on the React event, and actually close it on the hammer.js\n   * event.\n   */\n  _onClick(evt) {\n    if (this.props.captureClick) {\n      evt.stopPropagation();\n    }\n\n    if (this.props.closeOnClick || this._closeOnClick) {\n      this.props.onClose();\n    }\n  }\n\n  _onClose() {\n    this._closeOnClick = true;\n  }\n\n  _contentLoaded(ref) {\n    this._content = ref;\n  }\n\n  _renderTip() {\n    const {tipSize} = this.props;\n\n    return createElement('div', {\n      key: 'tip',\n      className: 'mapboxgl-popup-tip',\n      style: {borderWidth: tipSize}\n    });\n  }\n\n  _renderContent() {\n    const {closeButton, children} = this.props;\n    return createElement('div', {\n      key: 'content',\n      ref: this._contentLoaded,\n      className: 'mapboxgl-popup-content'\n    }, [\n      closeButton && createElement('button', {\n        key: 'close-button',\n        className: 'mapboxgl-popup-close-button',\n        type: 'button',\n        onClick: this._onClose\n      }, 'Ã—'),\n      children\n    ]);\n  }\n\n  render() {\n    const {className, longitude, latitude, offsetLeft, offsetTop} = this.props;\n\n    const [x, y] = this.context.viewport.project([longitude, latitude]);\n\n    const positionType = this._getPosition(x, y);\n    const anchorPosition = ANCHOR_POSITION[positionType];\n\n    const containerStyle = {\n      position: 'absolute',\n      left: x + offsetLeft,\n      top: y + offsetTop,\n      transform: `translate(${-anchorPosition.x * 100}%, ${-anchorPosition.y * 100}%)`\n    };\n\n    return createElement('div', {\n      className: `mapboxgl-popup mapboxgl-popup-anchor-${positionType} ${className}`,\n      style: containerStyle,\n      ref: this._onContainerLoad\n    }, [\n      this._renderTip(),\n      this._renderContent()\n    ]);\n  }\n\n}\n\nPopup.displayName = 'Popup';\nPopup.propTypes = propTypes;\nPopup.defaultProps = defaultProps;\n"],"file":"popup.js"}