"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createPathMarkers;

var _math = require("math.gl");

function getLineLength(vPoints) {
  // calculate total length
  var lineLength = 0;

  for (var i = 0; i < vPoints.length - 1; i++) {
    lineLength += vPoints[i].distance(vPoints[i + 1]);
  }

  return lineLength;
}

var DEFAULT_COLOR = [0, 0, 0, 255];
var DEFAULT_DIRECTION = {
  forward: true,
  backward: false
};

function createPathMarkers(_ref) {
  var data = _ref.data,
      _ref$getPath = _ref.getPath,
      getPath = _ref$getPath === void 0 ? function (x) {
    return x.path;
  } : _ref$getPath,
      _ref$getDirection = _ref.getDirection,
      getDirection = _ref$getDirection === void 0 ? function (x) {
    return x.direction;
  } : _ref$getDirection,
      _ref$getColor = _ref.getColor,
      getColor = _ref$getColor === void 0 ? function (x) {
    return DEFAULT_COLOR;
  } : _ref$getColor,
      _ref$getMarkerPercent = _ref.getMarkerPercentages,
      getMarkerPercentages = _ref$getMarkerPercent === void 0 ? function (x) {
    return [0.5];
  } : _ref$getMarkerPercent,
      projectFlat = _ref.projectFlat;
  var markers = [];
  var _iteratorNormalCompletion = true;
  var _didIteratorError = false;
  var _iteratorError = undefined;

  try {
    for (var _iterator = data[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
      var object = _step.value;
      var path = getPath(object);
      var direction = getDirection(object) || DEFAULT_DIRECTION;
      var color = getColor(object);
      var vPoints = path.map(function (p) {
        return new _math.Vector2(p);
      });
      var vPointsReverse = vPoints.slice(0).reverse(); // calculate total length

      var lineLength = getLineLength(vPoints); // Ask for where to put markers

      var percentages = getMarkerPercentages(object, {
        lineLength: lineLength
      }); // Create the markers

      var _iteratorNormalCompletion2 = true;
      var _didIteratorError2 = false;
      var _iteratorError2 = undefined;

      try {
        for (var _iterator2 = percentages[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
          var percentage = _step2.value;

          if (direction.forward) {
            var marker = createMarkerAlongPath({
              path: vPoints,
              percentage: percentage,
              lineLength: lineLength,
              color: color,
              object: object,
              projectFlat: projectFlat
            });
            markers.push(marker);
          }

          if (direction.backward) {
            var _marker = createMarkerAlongPath({
              path: vPointsReverse,
              percentage: percentage,
              lineLength: lineLength,
              color: color,
              object: object,
              projectFlat: projectFlat
            });

            markers.push(_marker);
          }
        }
      } catch (err) {
        _didIteratorError2 = true;
        _iteratorError2 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
            _iterator2.return();
          }
        } finally {
          if (_didIteratorError2) {
            throw _iteratorError2;
          }
        }
      }
    }
  } catch (err) {
    _didIteratorError = true;
    _iteratorError = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion && _iterator.return != null) {
        _iterator.return();
      }
    } finally {
      if (_didIteratorError) {
        throw _iteratorError;
      }
    }
  }

  return markers;
}

function createMarkerAlongPath(_ref2) {
  var path = _ref2.path,
      percentage = _ref2.percentage,
      lineLength = _ref2.lineLength,
      color = _ref2.color,
      object = _ref2.object,
      projectFlat = _ref2.projectFlat;
  var distanceAlong = lineLength * percentage;
  var currentDistance = 0;
  var previousDistance = 0;
  var i = 0;

  for (i = 0; i < path.length - 1; i++) {
    currentDistance += path[i].distance(path[i + 1]);

    if (currentDistance > distanceAlong) {
      break;
    }

    previousDistance = currentDistance;
  }

  var vDirection = path[i + 1].clone().subtract(path[i]).normalize();
  var along = distanceAlong - previousDistance;
  var vCenter = vDirection.clone().multiply(new _math.Vector2(along, along)).add(path[i]);
  var vDirection2 = new _math.Vector2(projectFlat(path[i + 1])).subtract(projectFlat(path[i]));
  var angle = -vDirection2.verticalAngle() * 180 / Math.PI;
  return {
    position: [vCenter.x, vCenter.y, 0],
    angle: angle,
    color: color,
    object: object
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wYXRoLW1hcmtlci1sYXllci9jcmVhdGUtcGF0aC1tYXJrZXJzLmpzIl0sIm5hbWVzIjpbImdldExpbmVMZW5ndGgiLCJ2UG9pbnRzIiwibGluZUxlbmd0aCIsImkiLCJsZW5ndGgiLCJkaXN0YW5jZSIsIkRFRkFVTFRfQ09MT1IiLCJERUZBVUxUX0RJUkVDVElPTiIsImZvcndhcmQiLCJiYWNrd2FyZCIsImNyZWF0ZVBhdGhNYXJrZXJzIiwiZGF0YSIsImdldFBhdGgiLCJ4IiwicGF0aCIsImdldERpcmVjdGlvbiIsImRpcmVjdGlvbiIsImdldENvbG9yIiwiZ2V0TWFya2VyUGVyY2VudGFnZXMiLCJwcm9qZWN0RmxhdCIsIm1hcmtlcnMiLCJvYmplY3QiLCJjb2xvciIsIm1hcCIsInAiLCJWZWN0b3IyIiwidlBvaW50c1JldmVyc2UiLCJzbGljZSIsInJldmVyc2UiLCJwZXJjZW50YWdlcyIsInBlcmNlbnRhZ2UiLCJtYXJrZXIiLCJjcmVhdGVNYXJrZXJBbG9uZ1BhdGgiLCJwdXNoIiwiZGlzdGFuY2VBbG9uZyIsImN1cnJlbnREaXN0YW5jZSIsInByZXZpb3VzRGlzdGFuY2UiLCJ2RGlyZWN0aW9uIiwiY2xvbmUiLCJzdWJ0cmFjdCIsIm5vcm1hbGl6ZSIsImFsb25nIiwidkNlbnRlciIsIm11bHRpcGx5IiwiYWRkIiwidkRpcmVjdGlvbjIiLCJhbmdsZSIsInZlcnRpY2FsQW5nbGUiLCJNYXRoIiwiUEkiLCJwb3NpdGlvbiIsInkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQSxTQUFTQSxhQUFULENBQXVCQyxPQUF2QixFQUFnQztBQUM5QjtBQUNBLE1BQUlDLFVBQVUsR0FBRyxDQUFqQjs7QUFDQSxPQUFLLElBQUlDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdGLE9BQU8sQ0FBQ0csTUFBUixHQUFpQixDQUFyQyxFQUF3Q0QsQ0FBQyxFQUF6QyxFQUE2QztBQUMzQ0QsSUFBQUEsVUFBVSxJQUFJRCxPQUFP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O0FBQ0RFLElBQUFBLGdCQUFnQixHQUFHRCxlQUFuQjtBQUNEOztBQUVELE1BQU1FLFVBQVUsR0FBR3ZCLElBQUksQ0FBQ1gsQ0FBQyxHQUFHLENBQUwsQ0FBSixDQUNoQm1DLEtBRGdCLEdBRWhCQyxRQUZnQixDQUVQekIsSUFBSSxDQUFDWCxDQUFELENBRkcsRUFHaEJxQyxTQUhnQixFQUFuQjtBQUlBLE1BQU1DLEtBQUssR0FBR1AsYUFBYSxHQUFHRSxnQkFBOUI7QUFDQSxNQUFNTSxPQUFPLEdBQUdMLFVBQVUsQ0FDdkJDLEtBRGEsR0FFYkssUUFGYSxDQUVKLElBQUlsQixhQUFKLENBQVlnQixLQUFaLEVBQW1CQSxLQUFuQixDQUZJLEVBR2JHLEdBSGEsQ0FHVDlCLElBQUksQ0FBQ1gsQ0FBRCxDQUhLLENBQWhCO0FBS0EsTUFBTTBDLFdBQVcsR0FBRyxJQUFJcEIsYUFBSixDQUFZTixXQUFXLENBQUNMLElBQUksQ0FBQ1gsQ0FBQyxHQUFHLENBQUwsQ0FBTCxDQUF2QixFQUFzQ29DLFFBQXRDLENBQStDcEIsV0FBVyxDQUFDTCxJQUFJLENBQUNYLENBQUQsQ0FBTCxDQUExRCxDQUFwQjtBQUNBLE1BQU0yQyxLQUFLLEdBQUksQ0FBQ0QsV0FBVyxDQUFDRSxhQUFaLEVBQUQsR0FBK0IsR0FBaEMsR0FBdUNDLElBQUksQ0FBQ0MsRUFBMUQ7QUFFQSxTQUFPO0FBQUNDLElBQUFBLFFBQVEsRUFBRSxDQUFDUixPQUFPLENBQUM3QixDQUFULEVBQVk2QixPQUFPLENBQUNTLENBQXBCLEVBQXVCLENBQXZCLENBQVg7QUFBc0NMLElBQUFBLEtBQUssRUFBTEEsS0FBdEM7QUFBNkN4QixJQUFBQSxLQUFLLEVBQUxBLEtBQTdDO0FBQW9ERCxJQUFBQSxNQUFNLEVBQU5BO0FBQXBELEdBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7VmVjdG9yMn0gZnJvbSAnbWF0aC5nbCc7XG5cbmZ1bmN0aW9uIGdldExpbmVMZW5ndGgodlBvaW50cykge1xuICAvLyBjYWxjdWxhdGUgdG90YWwgbGVuZ3RoXG4gIGxldCBsaW5lTGVuZ3RoID0gMDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB2UG9pbnRzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgIGxpbmVMZW5ndGggKz0gdlBvaW50c1tpXS5kaXN0YW5jZSh2UG9pbnRzW2kgKyAxXSk7XG4gIH1cbiAgcmV0dXJuIGxpbmVMZW5ndGg7XG59XG5cbmNvbnN0IERFRkFVTFRfQ09MT1IgPSBbMCwgMCwgMCwgMjU1XTtcbmNvbnN0IERFRkFVTFRfRElSRUNUSU9OID0ge2ZvcndhcmQ6IHRydWUsIGJhY2t3YXJkOiBmYWxzZX07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZVBhdGhNYXJrZXJzKHtcbiAgZGF0YSxcbiAgZ2V0UGF0aCA9IHggPT4geC5wYXRoLFxuICBnZXREaXJlY3Rpb24gPSB4ID0+IHguZGlyZWN0aW9uLFxuICBnZXRDb2xvciA9IHggPT4gREVGQVVMVF9DT0xPUixcbiAgZ2V0TWFya2VyUGVyY2VudGFnZXMgPSB4ID0+IFswLjVdLFxuICBwcm9qZWN0RmxhdFxufSkge1xuICBjb25zdCBtYXJrZXJzID0gW107XG5cbiAgZm9yIChjb25zdCBvYmplY3Qgb2YgZGF0YSkge1xuICAgIGNvbnN0IHBhdGggPSBnZXRQYXRoKG9iamVjdCk7XG4gICAgY29uc3QgZGlyZWN0aW9uID0gZ2V0RGlyZWN0aW9uKG9iamVjdCkgfHwgREVGQVVMVF9ESVJFQ1RJT047XG4gICAgY29uc3QgY29sb3IgPSBnZXRDb2xvcihvYmplY3QpO1xuXG4gICAgY29uc3QgdlBvaW50cyA9IHBhdGgubWFwKHAgPT4gbmV3IFZlY3RvcjIocCkpO1xuICAgIGNvbnN0IHZQb2ludHNSZXZlcnNlID0gdlBvaW50cy5zbGljZSgwKS5yZXZlcnNlKCk7XG5cbiAgICAvLyBjYWxjdWxhdGUgdG90YWwgbGVuZ3RoXG4gICAgY29uc3QgbGluZUxlbmd0aCA9IGdldExpbmVMZW5ndGgodlBvaW50cyk7XG5cbiAgICAvLyBBc2sgZm9yIHdoZXJlIHRvIHB1dCBtYXJrZXJzXG4gICAgY29uc3QgcGVyY2VudGFnZXMgPSBnZXRNYXJrZXJQZXJjZW50YWdlcyhvYmplY3QsIHtsaW5lTGVuZ3RofSk7XG5cbiAgICAvLyBDcmVhdGUgdGhlIG1hcmtlcnNcbiAgICBmb3IgKGNvbnN0IHBlcmNlbnRhZ2Ugb2YgcGVyY2VudGFnZXMpIHtcbiAgICAgIGlmIChkaXJlY3Rpb24uZm9yd2FyZCkge1xuICAgICAgICBjb25zdCBtYXJrZXIgPSBjcmVhdGVNYXJrZXJBbG9uZ1BhdGgoe1xuICAgICAgICAgIHBhdGg6IHZQb2ludHMsXG4gICAgICAgICAgcGVyY2VudGFnZSxcbiAgICAgICAgICBsaW5lTGVuZ3RoLFxuICAgICAgICAgIGNvbG9yLFxuICAgICAgICAgIG9iamVjdCxcbiAgICAgICAgICBwcm9qZWN0RmxhdFxuICAgICAgICB9KTtcbiAgICAgICAgbWFya2Vycy5wdXNoKG1hcmtlcik7XG4gICAgICB9XG5cbiAgICAgIGlmIChkaXJlY3Rpb24uYmFja3dhcmQpIHtcbiAgICAgICAgY29uc3QgbWFya2VyID0gY3JlYXRlTWFya2VyQWxvbmdQYXRoKHtcbiAgICAgICAgICBwYXRoOiB2UG9pbnRzUmV2ZXJzZSxcbiAgICAgICAgICBwZXJjZW50YWdlLFxuICAgICAgICAgIGxpbmVMZW5ndGgsXG4gICAgICAgICAgY29sb3IsXG4gICAgICAgICAgb2JqZWN0LFxuICAgICAgICAgIHByb2plY3RGbGF0XG4gICAgICAgIH0pO1xuICAgICAgICBtYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gbWFya2Vycztcbn1cblxuZnVuY3Rpb24gY3JlYXRlTWFya2VyQWxvbmdQYXRoKHtwYXRoLCBwZXJjZW50YWdlLCBsaW5lTGVuZ3RoLCBjb2xvciwgb2JqZWN0LCBwcm9qZWN0RmxhdH0pIHtcbiAgY29uc3QgZGlzdGFuY2VBbG9uZyA9IGxpbmVMZW5ndGggKiBwZXJjZW50YWdlO1xuICBsZXQgY3VycmVudERpc3RhbmNlID0gMDtcbiAgbGV0IHByZXZpb3VzRGlzdGFuY2UgPSAwO1xuICBsZXQgaSA9IDA7XG4gIGZvciAoaSA9IDA7IGkgPCBwYXRoLmxlbmd0aCAtIDE7IGkrKykge1xuICAgIGN1cnJlbnREaXN0YW5jZSArPSBwYXRoW2ldLmRpc3RhbmNlKHBhdGhbaSArIDFdKTtcbiAgICBpZiAoY3VycmVudERpc3RhbmNlID4gZGlzdGFuY2VBbG9uZykge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHByZXZpb3VzRGlzdGFuY2UgPSBjdXJyZW50RGlzdGFuY2U7XG4gIH1cblxuICBjb25zdCB2RGlyZWN0aW9uID0gcGF0aFtpICsgMV1cbiAgICAuY2xvbmUoKVxuICAgIC5zdWJ0cmFjdChwYXRoW2ldKVxuICAgIC5ub3JtYWxpemUoKTtcbiAgY29uc3QgYWxvbmcgPSBkaXN0YW5jZUFsb25nIC0gcHJldmlvdXNEaXN0YW5jZTtcbiAgY29uc3QgdkNlbnRlciA9IHZEaXJlY3Rpb25cbiAgICAuY2xvbmUoKVxuICAgIC5tdWx0aXBseShuZXcgVmVjdG9yMihhbG9uZywgYWxvbmcpKVxuICAgIC5hZGQocGF0aFtpXSk7XG5cbiAgY29uc3QgdkRpcmVjdGlvbjIgPSBuZXcgVmVjdG9yMihwcm9qZWN0RmxhdChwYXRoW2kgKyAxXSkpLnN1YnRyYWN0KHByb2plY3RGbGF0KHBhdGhbaV0pKTtcbiAgY29uc3QgYW5nbGUgPSAoLXZEaXJlY3Rpb24yLnZlcnRpY2FsQW5nbGUoKSAqIDE4MCkgLyBNYXRoLlBJO1xuXG4gIHJldHVybiB7cG9zaXRpb246IFt2Q2VudGVyLngsIHZDZW50ZXIueSwgMF0sIGFuZ2xlLCBjb2xvciwgb2JqZWN0fTtcbn1cbiJdfQ==