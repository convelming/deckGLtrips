/* eslint-disable no-inline-comments, max-len */
import { isWebGL2 } from '../webgl-utils';
const WEBGL_LIMITS = {
  [33902]: {
    gl1: new Float32Array([1, 1])
  },
  [33901]: {
    gl1: new Float32Array([1, 1])
  },
  [3379]: {
    gl1: 64,
    gl2: 2048
  },
  // GLint
  [34076]: {
    gl1: 16
  },
  // GLint
  [34930]: {
    gl1: 8
  },
  // GLint
  [35661]: {
    gl1: 8
  },
  // GLint
  [35660]: {
    gl1: 0
  },
  // GLint
  [34024]: {
    gl1: 1
  },
  // GLint
  [36348]: {
    gl1: 8
  },
  // GLint
  [34921]: {
    gl1: 8
  },
  // GLint
  [36347]: {
    gl1: 128
  },
  // GLint
  [36349]: {
    gl1: 16
  },
  // GLint
  [3386]: {
    gl1: new Int32Array([0, 0])
  },
  // Extensions
  // [GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT]: {gl1: 1.0, extension: 'EXT_texture_filter_anisotropic'},
  // WebGL2 Limits
  [32883]: {
    gl1: 0,
    gl2: 256
  },
  //  GLint
  [35071]: {
    gl1: 0,
    gl2: 256
  },
  // GLint
  [37447]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint64
  [36063]: {
    gl1: 0,
    gl2: 4
  },
  //  GLint
  [35379]: {
    gl1: 0,
    gl2: 0
  },
  // GLint64
  [35374]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint
  [35377]: {
    gl1: 0,
    gl2: 0
  },
  // GLint64
  [34852]: {
    gl1: 0,
    gl2: 4
  },
  // GLint
  [36203]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint64
  [33001]: {
    gl1: 0,
    gl2: 0
  },
  // GLint
  [33000]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint
  [37157]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint
  [35373]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint
  [35657]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint
  [36183]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint
  [37137]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint64
  [34045]: {
    gl1: 0,
    gl2: 0
  },
  // GLfloat
  [35978]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint
  [35979]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint
  [35968]: {
    gl1: 0,
    gl2: 0
  },
  // GLint
  [35376]: {
    gl1: 0,
    gl2: 0
  },
  // GLint64
  [35375]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint
  [35659]: {
    gl1: 0,
    gl2: 0
  },
  // GLint
  [37154]: {
    gl1: 0,
    gl2: 0
  },
  // GLint
  [35371]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint
  [35658]: {
    gl1: 0,
    gl2: 0
  },
  //  GLint
  [35076]: {
    gl1: 0,
    gl2: -8,
    negative: true
  },
  // GLint
  [35077]: {
    gl1: 0,
    gl2: 7
  },
  // GLint
  [35380]: {
    gl1: 0,
    gl2: 0 // GLint

  }
};
export function getContextLimits(gl) {
  gl.luma = gl.luma || {};

  if (!gl.luma.limits) {
    gl.luma.limits = {};
    gl.luma.webgl1MinLimits = {};
    gl.luma.webgl2MinLimits = {};
    const isWebgl2 = isWebGL2(gl); // WEBGL limits

    for (const parameter in WEBGL_LIMITS) {
      const limit = WEBGL_LIMITS[parameter];
      const webgl1MinLimit = limit.gl1;
      const webgl2MinLimit = 'gl2' in limit ? limit.gl2 : limit.gl1;
      const minLimit = isWebgl2 ? webgl2MinLimit : webgl1MinLimit; // Check if we can query for this limit

      const limitNotAvailable = 'gl2' in limit && !isWebgl2 || 'extension' in limit && !gl.getExtension(limit.extension);
      const value = limitNotAvailable ? minLimit : gl.getParameter(parameter);
      gl.luma.limits[parameter] = value;
      gl.luma.webgl1MinLimits[parameter] = webgl1MinLimit;
      gl.luma.webgl2MinLimits[parameter] = webgl2MinLimit;
    }
  }

  return gl.luma.limits;
}
export function getGLContextInfo(gl) {
  gl.luma = gl.luma || {};

  if (!gl.luma.info) {
    const info = gl.getExtension('WEBGL_debug_renderer_info');
    gl.luma.info = {
      [7936]: gl.getParameter(7936),
      [7937]: gl.getParameter(7937),
      [37445]: gl.getParameter(info && info.UNMASKED_VENDOR_WEBGL || 7936),
      [37446]: gl.getParameter(info && info.UNMASKED_RENDERER_WEBGL || 7937),
      [7938]: gl.getParameter(7938),
      [35724]: gl.getParameter(35724)
    };
  }

  return gl.luma.info;
}
const GL_UNMASKED_VENDOR_WEBGL = 0x9245; // vendor string of the graphics driver.

const GL_UNMASKED_RENDERER_WEBGL = 0x9246; // renderer string of the graphics driver.

export function getGLContextInfo2(gl) {
  const vendorMasked = gl.getParameter(7936);
  const rendererMasked = gl.getParameter(7937);
  const ext = gl.getExtension('WEBGL_debug_renderer_info');
  const vendorUnmasked = ext && gl.getParameter(ext.UNMASKED_VENDOR_WEBGL || 7936);
  const rendererUnmasked = ext && gl.getParameter(ext.UNMASKED_RENDERER_WEBGL || 7937);
  return {
    vendor: vendorUnmasked || vendorMasked,
    renderer: rendererUnmasked || rendererMasked,
    vendorMasked,
    rendererMasked,
    version: gl.getParameter(7938),
    shadingLanguageVersion: gl.getParameter(35724)
  };
}
export function getContextInfo(gl) {
  const limits = getContextLimits(gl);
  const info = getGLContextInfo(gl);
  return {
    // basic information
    vendor: info[GL_UNMASKED_VENDOR_WEBGL] || info[7936],
    renderer: info[GL_UNMASKED_RENDERER_WEBGL] || info[7937],
    version: info[7938],
    shadingLanguageVersion: info[35724],
    // info, caps and limits
    info,
    limits,
    webgl1MinLimits: gl.luma.webgl1MinLimits,
    webgl2MinLimits: gl.luma.webgl2MinLimits
  };
} // DEBUG INFO

/**
 * Provides strings identifying the GPU vendor and driver.
 * https://www.khronos.org/registry/webgl/extensions/WEBGL_debug_renderer_info/
 * @param {WebGLRenderingContext} gl - context
 * @return {Object} - 'vendor' and 'renderer' string fields.
 */

export function glGetDebugInfo(gl) {
  return getGLContextInfo2(gl); // const info = gl.getExtension('WEBGL_debug_renderer_info');
  // // We can't determine if 'WEBGL_debug_renderer_info' is supported by
  // // checking whether info is null here. Firefox doesn't follow the
  // // specs by returning null for unsupported extension. Instead,
  // // it returns an object without GL_UNMASKED_VENDOR_WEBGL and GL_UNMASKED_RENDERER_WEBGL.
  // return {
  //   vendor: (info && info.UNMASKED_VENDOR_WEBGL) ?
  //     gl.getParameter(info.UNMASKED_VENDOR_WEBGL) : 'unknown',
  //   renderer: (info && info.UNMASKED_RENDERER_WEBGL) ?
  //     gl.getParameter(info.UNMASKED_RENDERER_WEBGL) : 'unknown'
  // };
}
export const TEST_EXPORTS = {
  WEBGL_LIMITS
};
//# sourceMappingURL=context-limits.js.map