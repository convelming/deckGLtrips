{"version":3,"sources":["../../../../../src/shadertools/test/lib/inject-shader.spec.js"],"names":["injectShader","combineInjects","assembleShaders","createGLContext","test","fixture","gl","VS_GLSL_TEMPLATE","VS_GLSL_RESOLVED","FS_GLSL_TEMPLATE","FS_GLSL_RESOLVED","INJECT","INJECT2","COMBINED_INJECT","t","ok","undefined","end","injectResult","equal","assembleResult","vs","fs","inject","prologue","deepEqual"],"mappings":"AAAA;AACA,OAAOA,YAAP,IAAsBC,cAAtB,QAA2C,2CAA3C;AACA,SAAQC,eAAR,EAAyBC,eAAzB,QAA+C,SAA/C;AACA,OAAOC,IAAP,MAAiB,YAAjB;AAEA,MAAMC,OAAO,GAAG;AACdC,EAAAA,EAAE,EAAEH,eAAe;AADL,CAAhB;AAIA,MAAMI,gBAAgB,GAAI;;;;;;;;;;;;CAA1B;AAcA,MAAMC,gBAAgB,GAAI;;;;;;;;;;;;;CAA1B;AAeA,MAAMC,gBAAgB,GAAI;;;;;;;;;;;;;CAA1B;AAeA,MAAMC,gBAAgB,GAAI;;;;;;;;;;;;;;;;CAA1B;AAkBA,MAAMC,MAAM,GAAG;AACb,cAAY,8BADC;AAEb,cAAY,0BAFC;AAGb,oBAAkB,sCAHL;AAIb,kBAAgB;AAJH,CAAf;AAOA,MAAMC,OAAO,GAAG;AACd,cAAY,+BADE;AAEd,oBAAkB,sCAFJ;AAGd,oBAAkB;AAHJ,CAAhB;AAMA,MAAMC,eAAe,GAAG;AACtB,cAAY,6DADU;AAEtB,cAAY,0BAFU;AAGtB,oBAAkB,4EAHI;AAItB,kBAAgB,OAJM;AAKtB,oBAAkB;AALI,CAAxB;AAQAT,IAAI,CAAC,qBAAD,EAAwBU,CAAC,IAAI;AAC/BA,EAAAA,CAAC,CAACC,EAAF,CAAKf,YAAY,KAAKgB,SAAtB,EAAiC,gCAAjC;AACAF,EAAAA,CAAC,CAACG,GAAF;AACD,CAHG,CAAJ;AAKAb,IAAI,CAAC,2BAAD,EAA8BU,CAAC,IAAI;AACrC,MAAII,YAAJ;AAEAA,EAAAA,YAAY,GAAGlB,YAAY,CAACO,gBAAD,EAAmB,IAAnB,EAAyBI,MAAzB,CAA3B;AACAG,EAAAA,CAAC,CAACK,KAAF,CAAQD,YAAR,EAAsBV,gBAAtB,EAAwC,oBAAxC;AAEAU,EAAAA,YAAY,GAAGlB,YAAY,CAACS,gBAAD,EAAmB,IAAnB,EAAyBE,MAAzB,CAA3B;AACAG,EAAAA,CAAC,CAACK,KAAF,CAAQD,YAAR,EAAsBR,gBAAtB,EAAwC,oBAAxC;AAEAI,EAAAA,CAAC,CAACG,GAAF;AACD,CAVG,CAAJ;AAYAb,IAAI,CAAC,8BAAD,EAAiCU,CAAC,IAAI;AACxC,QAAMM,cAAc,GAAGlB,eAAe,CAACG,OAAO,CAACC,EAAT,EAAa;AACjDe,IAAAA,EAAE,EAAEd,gBAD6C;AAEjDe,IAAAA,EAAE,EAAEb,gBAF6C;AAGjDc,IAAAA,MAAM,EAAEZ,MAHyC;AAIjDa,IAAAA,QAAQ,EAAE;AAJuC,GAAb,CAAtC;AAMAV,EAAAA,CAAC,CAACK,KAAF,CAAQC,cAAc,CAACC,EAAvB,EAA2Bb,gBAA3B,EAA6C,oBAA7C;AACAM,EAAAA,CAAC,CAACK,KAAF,CAAQC,cAAc,CAACE,EAAvB,EAA2BZ,gBAA3B,EAA6C,oBAA7C;AAEAI,EAAAA,CAAC,CAACG,GAAF;AACD,CAXG,CAAJ;AAaAb,IAAI,CAAC,6BAAD,EAAgCU,CAAC,IAAI;AACvCA,EAAAA,CAAC,CAACW,SAAF,CAAYxB,cAAc,CAAC,CAACU,MAAD,EAASC,OAAT,CAAD,CAA1B,EAA+CC,eAA/C,EAAgE,4BAAhE;AACAC,EAAAA,CAAC,CAACG,GAAF;AACD,CAHG,CAAJ","sourcesContent":["/* eslint-disable camelcase */\nimport injectShader, {combineInjects} from 'luma.gl/shadertools/src/lib/inject-shader';\nimport {assembleShaders, createGLContext} from 'luma.gl';\nimport test from 'tape-catch';\n\nconst fixture = {\n  gl: createGLContext()\n};\n\nconst VS_GLSL_TEMPLATE = `\\\n#version 300 es\n\nin vec4 positions;\nout vec4 vColor;\n\nvoid f(out float a, in float b) {}\n\nvoid main(void) {\n  gl_Position = positions;\n  vColor = vec4(1., 0., 0., 1.);\n}\n`;\n\nconst VS_GLSL_RESOLVED = `\\\n#version 300 es\nuniform float uNewUniform;\n\nin vec4 positions;\nout vec4 vColor;\n\nvoid f(out float a, in float b) {}\n\nvoid main(void) {\n  gl_Position = positions;\n  vColor = vec4(1., 0., 0., 1.);\n}\n`;\n\nconst FS_GLSL_TEMPLATE = `\\\n#version 300 es\n\nprecision highp float;\n\nout vec4 fragmentColor;\nin vec4 vColor;\n\nvoid f(out float a, in float b) {}\n\nvoid main(void) {\n  fragmentColor = vColor;\n}\n`;\n\nconst FS_GLSL_RESOLVED = `\\\n#version 300 es\nuniform bool uDiscard;\n\nprecision highp float;\n\nout vec4 fragmentColor;\nin vec4 vColor;\n\nvoid f(out float a, in float b) {}\n\nvoid main(void) {\n  if (uDiscard} { discard } else {\n  fragmentColor = vColor;\n  }\n}\n`;\n\nconst INJECT = {\n  'vs:#decl': 'uniform float uNewUniform;\\n',\n  'fs:#decl': 'uniform bool uDiscard;\\n',\n  'fs:#main-start': '  if (uDiscard} { discard } else {\\n',\n  'fs:#main-end': '  }\\n'\n};\n\nconst INJECT2 = {\n  'vs:#decl': 'uniform float uNewUniform2;\\n',\n  'fs:#main-start': '  uNewUniform2 = uNewUniform + 1.;\\n',\n  'vs:#main-start': ' uNewUniform = uNewUniform2;\\n'\n};\n\nconst COMBINED_INJECT = {\n  'vs:#decl': 'uniform float uNewUniform;\\n\\nuniform float uNewUniform2;\\n',\n  'fs:#decl': 'uniform bool uDiscard;\\n',\n  'fs:#main-start': '  if (uDiscard} { discard } else {\\n\\n  uNewUniform2 = uNewUniform + 1.;\\n',\n  'fs:#main-end': '  }\\n',\n  'vs:#main-start': ' uNewUniform = uNewUniform2;\\n'\n};\n\ntest('injectShader#import', t => {\n  t.ok(injectShader !== undefined, 'injectShader import successful');\n  t.end();\n});\n\ntest('injectShader#injectShader', t => {\n  let injectResult;\n\n  injectResult = injectShader(VS_GLSL_TEMPLATE, 'vs', INJECT);\n  t.equal(injectResult, VS_GLSL_RESOLVED, 'correctly injected');\n\n  injectResult = injectShader(FS_GLSL_TEMPLATE, 'fs', INJECT);\n  t.equal(injectResult, FS_GLSL_RESOLVED, 'correctly injected');\n\n  t.end();\n});\n\ntest('injectShader#assembleShaders', t => {\n  const assembleResult = assembleShaders(fixture.gl, {\n    vs: VS_GLSL_TEMPLATE,\n    fs: FS_GLSL_TEMPLATE,\n    inject: INJECT,\n    prologue: false\n  });\n  t.equal(assembleResult.vs, VS_GLSL_RESOLVED, 'correctly injected');\n  t.equal(assembleResult.fs, FS_GLSL_RESOLVED, 'correctly injected');\n\n  t.end();\n});\n\ntest('injectShader#combineInjects', t => {\n  t.deepEqual(combineInjects([INJECT, INJECT2]), COMBINED_INJECT, 'injects correctly combined');\n  t.end();\n});\n"],"file":"inject-shader.spec.js"}