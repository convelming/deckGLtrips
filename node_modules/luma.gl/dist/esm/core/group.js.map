{"version":3,"sources":["../../../src/core/group.js"],"names":["Object3D","Matrix4","assert","Group","opts","Array","isArray","children","every","child","add","push","indexOf","splice","visitor","modelMatrix","matrix","multiplyRight","result","traverse","i","length","traverseReverse"],"mappings":"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","sourcesContent":["import Object3D from './object-3d';\nimport {Matrix4} from 'math.gl';\nimport assert from '../utils/assert';\n\nexport default class Group extends Object3D {\n  constructor(opts = {}) {\n    opts = Array.isArray(opts) ? {children: opts} : opts;\n    const {children = []} = opts;\n    children.every(child => assert(child instanceof Object3D));\n    super(opts);\n    this.children = children;\n  }\n\n  // Unpacks arrays and nested arrays of children\n  add(...children) {\n    for (const child of children) {\n      if (Array.isArray(child)) {\n        this.add(...child);\n      } else {\n        this.children.push(child);\n      }\n    }\n    return this;\n  }\n\n  remove(child) {\n    const children = this.children;\n    const indexOf = children.indexOf(child);\n    if (indexOf > -1) {\n      children.splice(indexOf, 1);\n    }\n    return this;\n  }\n\n  removeAll() {\n    this.children = [];\n    return this;\n  }\n\n  // If visitor returns a truthy value, traversal will be aborted and that value\n  // will be returned from `traverse`. Otherwise `traverse` will return null.\n  traverse(visitor, {modelMatrix = new Matrix4()} = {}) {\n    for (const child of this.children) {\n      const {matrix} = child;\n      modelMatrix = modelMatrix.multiplyRight(matrix);\n      let result;\n      if (child instanceof Group) {\n        result = child.traverse(visitor, {modelMatrix});\n      } else {\n        // child.setUniforms({modelMatrix});\n        result = visitor(child, {});\n      }\n      // Abort if a result was returned\n      if (result) {\n        return result;\n      }\n    }\n    return null;\n  }\n\n  // If visitor returns a truthy value, traversal will be aborted and that value\n  // will be returned from `traverseReverse`. Otherwise `traverseReverse` will return null.\n  traverseReverse(visitor, {modelMatrix = new Matrix4()} = {}) {\n    for (let i = this.children.length - 1; i >= 0; --i) {\n      const child = this.children[i];\n      const {matrix} = child;\n      modelMatrix = modelMatrix.multiplyRight(matrix);\n      let result;\n      if (child instanceof Group) {\n        result = child.traverseReverse(visitor, {modelMatrix});\n      } else {\n        // child.setUniforms({modelMatrix});\n        result = visitor(child, {});\n      }\n      // Abort if a result was returned\n      if (result) {\n        return result;\n      }\n    }\n    return null;\n  }\n}\n"],"file":"group.js"}